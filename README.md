## Stroke Prediction System (Dockerized)

This project is a fully Dockerized Stroke Prediction System built using **FastAPI (server)** and **Streamlit (client)**. The app allows users to input health-related details and predicts the risk of a stroke using a trained machine learning model.

- **FastAPI** (Backend API)
- **Streamlit** (Frontend UI)
- **Docker** (Client & Server containers)
- **Pydantic** for data validation
- **Feature Engineering** for preprocessing

##  Architecture
![Architecture Diagram](images/fastapi.drawio.svg)

- Client: Streamlit frontend for collecting input and displaying prediction.
- Server: FastAPI backend for data validation, feature engineering, and prediction.
- ML Model: Trained with scikit-learn and saved as a .pkl file.
- Docker Compose: Runs client and server containers.

## Project Structure
```bash
stroke-prediction-app/
├── client/
│   ├── home.py
│   ├── requirements.txt
│   └── Dockerfile
├── server/
│   ├── main.py
│   ├── schema.py
│   ├── feature_engineering.py
│   ├── model.pkl
│   ├── requirements.txt
│   └── Dockerfile
├── docker-compose.yml
└── README.md
```
## Technologies Used
- Frontend: Streamlit
- Backend: FastAPI
- Model: scikit-learn (model.pkl)
- Validation: Pydantic
- Feature Engineering: Custom BMI and encoding logic
- Docker: Client and server containers
- Orchestration: Docker Compose

###  Docker Containers
- **client**: Runs Streamlit frontend on port 8501
- **server**: Runs FastAPI backend on port 8000



## Getting Started

#### Prerequisites
- Docker
- Docker Compose
- Streamlit
- FastApi
- Machine Learning.

### Model Input Features
- Age
- Weight (kg)
- Height (m)
- Gender
- Smoking status
- Heart Disease
- Hypertension
- Residence Type
- Work Type
- Average Glucose Level.



1. **The API will be available at**: http://localhost:8000

2. **Clone the repo** 
```bash
git clone https://github.com/Towshin05/Fast-Api-Stroke.git
cd Fast-API

```
3. **Run the project**
```bash
docker-compose up --build
```
#### Api Endpoints
4. **Health Check**
```bash
GET /health
```
Returns API status and version information.

5. **Predict Stroke Risk**

```bash
POST /predict
```

### Example Request
 ```bash
 {
  "age": 30,
  "weight_kg": 70.0,
  "height_m": 1.75,
  "smoking": "yes",
  "gender": "male",
  "heart_disease": "no",
  "hypertension": "no",
  "Residence_type": "New York",
  "work_type": "Part-time",
  "avg_glucose_level": 100.0
}
```
#### Response
```bash
{
  "prediction": [1],
  "probability": [[0.23, 0.77],
  "risk_level": "High",
  "timestamp": "2025-06-12T10:30:00Z"
}
```
 ### API Documentation
- Once running, visit:

**Swagger UI**: http://localhost:8000/docs
**ReDoc**: http://localhost:8000/redoc
 ### Api Testing

 ```bash
 # Using curl
curl -X POST "http://localhost:8000/predict" \
     -H "Content-Type: application/json" \
     -d '{
       "age": 45,
       "hypertension": 0,
       "heart_disease": 0,
       "ever_married": "Yes",
       "work_type": "Private",
       "residence_type": "Urban",
       "avg_glucose_level": 85.0,
       "bmi": 25.0,
       "smoking_status": "never smoked",
       "gender": "Female"
     }' 
     
```
### Troubleshooting
1. **Version Mismatch Warnings**
```bash
InconsistentVersionWarning: Trying to unpickle estimator from version 1.6.1 when using version 1.6.0
```
**Solution**
```bash
# Uninstall and reinstall correct version
docker run -p 8000:8000 -v "H:/Fast-API:/app" --workdir /app/server towshin/stroke-pred-api bash -c "pip uninstall -y scikit-learn && pip install scikit-learn==1.6.1 xgboost && uvicorn app:app --host 0.0.0.0 --port 8000"
```
2. **Multiple Scikit-learn Versions Installed**

```bash
# Complete cleanup
docker run -p 8000:8000 -v "H:/Fast-API:/app" --workdir /app/server towshin/stroke-pred-api bash -c "pip freeze | grep scikit-learn | xargs pip uninstall -y && pip cache purge && pip install scikit-learn==1.6.1 xgboost && uvicorn app:app --host 0.0.0.0 --port 8000"


```
3. **XGBoost Serialization Warning**

WARNING: If you are loading a serialized model (like pickle in Python, RDS in R) or configuration generated by an older version of XGBoost...

**Solution**
Rebuild model using current XGBoost version or use **model.save_model()** instead of pickle.

### License
MIT

### Contribution
Towshin05

